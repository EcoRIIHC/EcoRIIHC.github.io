---
layout: post
title:  "Nginx反向代理解决跨域问题"
date:   2016-12-22 19:56:27 GMT+0800
categories: 前端调试
tag: Nginx反向代理
---

* content
{:toc}

>这篇并不是要写如何解决跨域问题，之后有时间会单独整理一下实际项目中的跨域解决方案。而是对于方便前端调试的方案，当然也可以用于项目实战中解决跨域问题。

问题描述
-----------------


问题来源于实际项目中，在这个webpack盛行的年代，很多时候我们的项目前端代码是分离开的，利用webpack开启本地服务，加上自带的热加载，代码调试开心得不行。

但是问题随之而来，需要和后端的同学联调接口的时候，面临着跨域的问题，此时我们有两个选择，

1.在自己电脑上搭建一整套运行环境，在localhost下完成所有调试

2.暴力得解开服务端访问限制，将其开源

我们通常会选择后者...虽然问题已经解决，但总觉得这种方式很low或者不够优雅，于是参考了一下资料，折腾一下Nginx反向代理。

正向代理和反向代理
---------------------

在这之前，有必要现在搞清楚这两个概念。相信许多同学和我之前一样，听到反向代理觉得无比高大上，这就提到一本前端要读的书，《Http权威指南》。

那么来说说我的理解：

**正向代理：**就是我们通常用vpn翻墙的方式。我们访问不到国外的服务器，那么就通过访问代理服务器，代理服务器代替我们访问国外服务器，然后将数据返回，这样我们就可以访问国外的网站。当然，**这当中我们要自己配置代理，也就是说，我们知道我们所访问的是代理服务器。**

**反向代理：**和正向代理相反，作为用户的我们**并不知道我们访问的是代理服务器**，对于我们来说，这就是源服务器。代理服务器在接收到我们的请求后，将请求转发给真正的源服务器，从源服务器拿到数据再返回，**转发请求返回结果的过程对于我们不知道的。**

Nginx基本操作
---------------------

首先，要装好nginx环境。到[Nginx官网](http://nginx.org/en/download.html)下载最新的稳定版Nginx。

然后用命令行打开Nginx，windows环境下的使用非常简单。常用的几条命令：

    nginx             // 启动
    nginx -s stop     // 停止
    nginx -t          // 检查配置文件是否正确，这条命令同时能够找到nginx路径，非常的方便~
    nginx -s reload   // 重新加载配置文件，不需要重启

Nginx跨域配置
-----------------------

OK，接下来就是正题，假如现在已经将本地的webpack server跑起来，访问地址`http://localhost:8080/`，而后端提供的接口的地址的路径为`http://120.182.35.24/test`，显然会有跨域问题。打开nginx下./conf/nginx.conf，修改server的部分，

    server {
        listen       80;
        server_name  localhost;

        location / {
            proxy_pass http://localhost:8080/;
        }
        location /test {
            proxy_pass http://120.182.35.24/test;
        }    
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

`server`代表一个服务，`listen`是监听的端口号，location是服务的路径，核心就是`proxy_pass`请求转发，在配置中我们定义了两个请求转发，

+ 在我们请求`http://localhost:80`时，将请求转发到`http://localhost:8080/`
+ 之后请求地址为`/test`开头的接口时，将请求转发到`http://120.182.35.24/test`

接下来的事情就简单明了，我们需要做的就是将前端代码中访问接口的地址，由`http://120.182.35.24/test`修改为`http://localhost:80/test`，大家的项目肯定都有总的配置路径的文件，改这个也就一行代码~

再到浏览器中，访问`http://localhost:80/test`，打开控制台看请求路径，是不是变成了`http://localhost:80/test`，并且不存在跨域问题了呢。

总结
-------------

Nginx反向代理的方式来解决调试中跨域的问题，成本低见效快不用修改服务器*&%&…￥#@#@^……

嗯，其实还经常用fiddler+willow来调试做得差不多的项目，这货特别是调试手机端贼方便，之后再单独总结一篇~
